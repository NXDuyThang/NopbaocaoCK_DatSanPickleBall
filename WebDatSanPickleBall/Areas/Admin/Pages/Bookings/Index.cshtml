@page
@model WebDatSanPickleBall.Areas.Admin.Pages.Bookings.IndexModel
@{
    ViewData["Title"] = "Quản lý đặt sân";
}
<h2>Quản lý đặt sân</h2>
@if (TempData["Message"] != null)
{
    <div class="alert alert-success">@TempData["Message"]</div>
}
<form method="get" class="row g-2 mb-3">
    <div class="col-md-2">
        <input type="text" name="UserName" value="@Model.UserName" class="form-control" placeholder="Người đặt">
    </div>
    <div class="col-md-2">
        <input type="text" name="CourtName" value="@Model.CourtName" class="form-control" placeholder="Tên sân">
    </div>
    <div class="col-md-2">
        <input type="date" name="FromDate" value="@Model.FromDateStr" class="form-control" placeholder="Từ ngày">
    </div>
    <div class="col-md-2">
        <input type="date" name="ToDate" value="@Model.ToDateStr" class="form-control" placeholder="Đến ngày">
    </div>
    <div class="col-md-2">
        <select name="Status" class="form-select">
            <option value="">Tất cả trạng thái</option>
            <option value="Pending" selected="@(Model.Status=="Pending" ? "selected" : null)">Chờ xác nhận</option>
            <option value="Confirmed" selected="@(Model.Status=="Confirmed" ? "selected" : null)">Đã xác nhận</option>
            <option value="Cancelled" selected="@(Model.Status=="Cancelled" ? "selected" : null)">Đã hủy</option>
            <option value="Completed" selected="@(Model.Status=="Completed" ? "selected" : null)">Hoàn thành</option>
        </select>
    </div>
    <div class="col-md-2">
        <button class="btn btn-primary w-100">Lọc</button>
    </div>
</form>
<form method="post" asp-page-handler="FixCompletedBookings">
    <button type="submit" class="btn btn-warning mb-3">Cập nhật lại tổng tiền cho các booking hoàn thành</button>
</form>
<table class="table table-bordered table-hover">
    <thead>
        <tr>
            <th>Người đặt</th>
            <th>Sân</th>
            <th>Ngày</th>
            <th>Trạng thái</th>
            <th>Thao tác</th>
        </tr>
    </thead>
    <tbody>
    @foreach (var b in Model.Bookings)
    {
        <tr>
            <td>@b.User?.UserName</td>
            <td>@b.Court?.Name</td>
            <td>@b.BookingDate.ToString("dd/MM/yyyy")</td>
            <td>@b.Status</td>
            <td>
                <a asp-page="Details" asp-route-id="@b.BookingID" class="btn btn-sm btn-info">Chi tiết</a>
                @if (b.Status == DAL.Models.BookingStatus.Pending)
                {
                    <form method="post" asp-page-handler="Confirm" asp-route-id="@b.BookingID" style="display:inline">
                        <button class="btn btn-sm btn-success">Xác nhận</button>
                    </form>
                    <form method="post" asp-page-handler="Cancel" asp-route-id="@b.BookingID" style="display:inline">
                        <button class="btn btn-sm btn-danger">Hủy</button>
                    </form>
                }
                @if (b.Status == DAL.Models.BookingStatus.Confirmed)
                {
                    <form method="post" asp-page-handler="Complete" asp-route-id="@b.BookingID" style="display:inline">
                        <button class="btn btn-sm btn-primary">Hoàn thành</button>
                    </form>
                }
            </td>
        </tr>
    }
    </tbody>
</table> 